<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Carbon Currency - Full Form (Photo Integrated)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Fredoka:600&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(120deg, #d4fc79 0%, #96e6a1 30%, #6fd7f7 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      color: #234b1c;
      overflow-x: hidden;
    }
    .floating-leaf, .floating-leaf2 {
      position: absolute;
      z-index: 1;
      opacity: 0.12;
      pointer-events: none;
      animation: float-leaf 7s infinite alternate ease-in-out;
    }
    .floating-leaf { left: 5vw; top: 3vh; width: 84px;}
    .floating-leaf2 { right: 8vw; bottom: 6vh; width: 106px; animation-delay: 3.5s;}
    @keyframes float-leaf {
      from { transform: translateY(-12px) scale(1);}
      to   { transform: translateY(18px) scale(1.05);}
    }
    .container {
      background: #ffffffea;
      margin: 60px auto 0 auto;
      max-width: 540px;
      width: 96vw;
      padding: 42px 6vw 32px 6vw;
      border-radius: 22px;
      box-shadow: 0 6px 36px rgba(60,128,83,0.14), 0 2px 10px rgba(34,75,28,0.12);
      border: 2.5px solid #9ee6e1;
      position: relative;
      z-index: 3;
      overflow: visible;
    }
    .eco-mascot {
      position: absolute;
      top: -62px;
      left: 50%;
      transform: translateX(-50%);
      width: 98px;
      height: 98px;
      background: #fffdfc;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 20px rgba(0,0,0,0.10);
      border: 3px solid #e4ffdc;
      z-index: 2;
    }
    .eco-mascot svg {
      width: 66px;
      height: 66px;
      display: block;
    }
    .banner {
      text-align: center;
      margin-bottom: 20px;
      margin-top: 10px;
      padding: 8px;
      background: linear-gradient(90deg, #6fd7f7 30%, #48b97d 100%);
      color: #fff;
      border-radius: 10px;
      font-weight: bold;
      font-family: 'Fredoka', 'Montserrat', Arial, sans-serif;
      font-size: 1.23rem;
      letter-spacing: 0.8px;
      box-shadow: 0 2px 8px rgba(60,128,83,0.12);
      border: 1.5px solid #b6e2a1;
      user-select: none;
    }
    h2 {
      text-align: center;
      color: #2e6b3b;
      letter-spacing: 1px;
      margin-top: 18px;
      margin-bottom: 10px;
      font-weight: 800;
      font-size: 2.2rem;
      font-family: 'Fredoka', 'Montserrat', Arial, sans-serif;
      background: linear-gradient(90deg, #48b97d 20%, #3eb8ea 80%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    label {
      display: block;
      margin-top: 19px;
      font-weight: 600;
      letter-spacing: 0.5px;
      color: #214d28;
      font-size: 1.06em;
      position: relative;
    }
    .tip { display: none !important; }
    input[type="text"],
    input[type="email"],
    textarea,
    input[type="file"] {
      width: 100%;
      padding: 12px 13px;
      margin-top: 8px;
      border: 2px solid #b6e2a1;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 18px;
      background: #f4fef3;
      color: #234b1c;
      transition: border-color 0.2s, box-shadow 0.18s;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    input[type="file"] {
      font-size: 16px;
      padding: 8px 0;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    textarea:focus {
      border-color: #3ed4bb;
      background: #e7fde9;
      box-shadow: 0 0 6px #7df6c3a0;
      outline: none;
    }
    .initiatives-list {
      margin-top: 14px;
      margin-bottom: 12px;
      padding-left: 7px;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }
    .initiative-label {
      font-weight: 500;
      display: flex;
      align-items: center;
      color: #2e6b3b;
      font-size: 1.07rem;
      cursor: pointer;
      border-radius: 8px;
      background: #f8fdff;
      padding: 7px 10px;
      transition: background 0.14s, color 0.14s;
      border: 1px solid #e3f8ea;
      gap: 7px;
      position: relative;
    }
    .initiative-label:hover {
      background: #d0f7e9;
      color: #125d35;
    }
    .initiatives-list input[type="checkbox"] {
      accent-color: #48b97d;
      transform: scale(1.23);
      margin-right: 10px;
    }
    .initiative-icon {
      margin-right: 7px;
      font-size: 1.25em;
    }
    .other-initiative input[type="text"] {
      width: 65%;
      margin-left: 7px;
      margin-bottom: 0;
      font-size: 1em;
      background: #f4fef3;
      border-color: #b6e2a1;
      border-radius: 7px;
      padding: 6px 9px;
    }
    #photo-proof-label {
      margin-top: 21px;
      font-weight: 700;
      color: #217c32;
      letter-spacing: 0.5px;
    }
    #proof-photo {
      margin-top: 10px;
      background: #f4fef3;
      border-radius: 8px;
      border: 2px solid #b6e2a1;
      padding: 8px 0;
      width: 100%;
      font-size: 1rem;
      display: block;
      color: #234b1c;
    }
    button, input[type="submit"] {
      background: linear-gradient(90deg, #48b97d 20%, #51e673 80%);
      color: #fff;
      border: none;
      padding: 16px 0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.22rem;
      font-weight: bold;
      margin-top: 28px;
      width: 100%;
      box-shadow: 0 2px 8px rgba(60,128,83,0.12);
      transition: background 0.17s, box-shadow 0.2s, transform 0.17s;
      letter-spacing: 1.2px;
      font-family: 'Fredoka', 'Montserrat', Arial, sans-serif;
      position: relative;
      z-index: 2;
    }
    button:hover, input[type="submit"]:hover {
      background: linear-gradient(90deg, #51e673 0%, #48b97d 100%);
      box-shadow: 0 4px 18px rgba(60,128,83,0.20);
      transform: scale(1.025);
    }
    #formStatus {
      margin-top: 18px;
      text-align: center;
      font-weight: 600;
      font-size: 1.1em;
      letter-spacing: 0.5px;
      min-height: 30px;
      color: #d34b2d;
    }
    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(212,252,121,0.92);
      backdrop-filter: blur(1.5px);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      transition: opacity 0.3s;
    }
    #loadingOverlay.active { display: flex; }
    .eco-hero-message {
      font-size: 1.7rem;
      font-weight: bold;
      color: #2e6b3b;
      margin-top: 28px;
      text-align: center;
      letter-spacing: 1px;
      line-height: 1.3;
      font-family: 'Fredoka', Arial, sans-serif;
    }
    .eco-hero-leaf {
      animation: leaf-bounce 1.3s infinite alternate cubic-bezier(.47,1.64,.41,.8);
      margin-bottom: 14px;
    }
    @keyframes leaf-bounce {
      0% { transform: scale(1) translateY(0);}
      65% { transform: scale(1.1) translateY(-12px);}
      100% { transform: scale(1) translateY(0);}
    }
    .confetti {
      pointer-events: none;
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      z-index: 99999;
      overflow: hidden;
      display: none;
    }
    .confetti-piece {
      position: absolute;
      width: 12px; height: 18px;
      border-radius: 3px;
      opacity: 0.85;
      will-change: transform;
    }
    .rewards-section {
      margin-bottom: 26px;
      margin-top: 10px;
    }
    .points-badges-flex {
      display: flex;
      gap: 24px;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .my-points-block, .my-badges-block {
      min-width: 150px;
      flex: 1 1 140px;
    }
    .points-label, .badges-label, .group-label {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 6px;
      color: #227c32;
      letter-spacing: .5px;
    }
    .meter-bar {
      background: #e2f3e7;
      height: 18px;
      width: 100%;
      border-radius: 9px;
      box-shadow: 0 1px 4px #0001;
      overflow: hidden;
      margin-bottom: 5px;
      margin-top: 2px;
      position: relative;
    }
    .meter-fill {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, #51e673 0%, #48b97d 100%);
      width: 0%;
      border-radius: 9px;
      transition: width .5s cubic-bezier(.6,1.7,.27,.85);
    }
    .meter-fill.group {
      background: linear-gradient(90deg, #6fd7f7 0%, #b6e2a1 100%);
    }
    .points-score, .group-score {
      font-size: 1.1em;
      text-align: left;
      margin-bottom: 2px;
    }
    .badges-area {
      font-size: 1.7em;
      display: flex;
      gap: 2px;
      flex-wrap: wrap;
      margin-bottom: 0;
    }
    .next-badge-msg {
      font-size: 0.97em;
      color: #4ba691;
      margin-top: 4px;
    }
    .group-achievement-block {
      margin-top: 14px;
      background: #f7fbf9;
      padding: 9px 12px 8px 12px;
      border-radius: 9px;
      border: 1.5px solid #d7f3e2;
    }
    .group-label {
      margin-bottom: 4px;
    }
    @media (max-width: 600px) {
      .container { padding: 7vw 2vw 10vw 2vw; }
      .eco-mascot { width: 60px; height: 60px; top: -40px;}
      .eco-mascot svg { width: 38px; height: 38px;}
      .banner { font-size: 1.02rem; }
      h2 { font-size: 1.36rem; }
      .rewards-section { margin-bottom: 16px; }
      .points-badges-flex { flex-direction: column; gap: 12px; }
    }
    html { -webkit-text-size-adjust: 100%; }
    input, select, textarea { font-size: 16px !important; }
  </style>
</head>
<body>
  <div class="floating-leaf">
    <svg viewBox="0 0 48 48" fill="none">
      <ellipse cx="24" cy="24" rx="22" ry="22" fill="#3ed4bb"/>
      <path d="M13 35c10-17.5 22-22 22-22s-2 12-12 22c-4 4-8 0-10 0z" fill="#67c568" />
    </svg>
  </div>
  <div class="floating-leaf2">
    <svg viewBox="0 0 72 72" fill="none">
      <ellipse cx="36" cy="36" rx="33" ry="33" fill="#b6e2a1"/>
      <path d="M18 54c18-31.5 36-39.6 36-39.6s-3.3 21.6-19.7 39.6c-6.6 7.2-13.1 0-16.3 0z" fill="#67c568"/>
      <path d="M27 47c5.4-14.4 18-27 25.2-30.6" stroke="#2e6b3b" stroke-width="2.2" stroke-linecap="round"/>
    </svg>
  </div>
  <div class="container">
    <div class="eco-mascot">
      <svg width="66" height="66" viewBox="0 0 66 66" fill="none">
        <ellipse cx="33" cy="33" rx="30" ry="30" fill="#ffe066"/>
        <ellipse cx="33" cy="33" rx="16" ry="12" fill="#fffbe6"/>
        <ellipse cx="33" cy="38" rx="11" ry="14" fill="#ffd700"/>
        <ellipse cx="33" cy="38" rx="11" ry="14" fill="none" stroke="#222" stroke-width="2"/>
        <rect x="29" y="27" width="2.5" height="22" rx="1.2" fill="#222" />
        <rect x="33.5" y="27" width="2.5" height="22" rx="1.2" fill="#222" />
        <ellipse cx="25" cy="28" rx="6" ry="10" fill="#e0f7fa" opacity="0.8"/>
        <ellipse cx="41" cy="28" rx="6" ry="10" fill="#e0f7fa" opacity="0.8"/>
        <ellipse cx="30" cy="36" rx="1.2" ry="1.6" fill="#222"/>
        <ellipse cx="36" cy="36" rx="1.2" ry="1.6" fill="#222"/>
        <path d="M31 41 Q33 43 35 41" stroke="#222" stroke-width="1.2" fill="none"/>
        <path d="M28 25 Q26 23 27 20" stroke="#222" stroke-width="1" fill="none"/>
        <path d="M38 25 Q40 23 39 20" stroke="#222" stroke-width="1" fill="none"/>
      </svg>
    </div>
    <div class="banner">Every action counts! You are one point away from being the Eco Champion of PASUM!</div>
    <!-- REWARDS/BADGES/POINTS METER SECTION -->
    <div class="rewards-section">
      <div class="points-badges-flex">
        <div class="my-points-block">
          <div class="points-label">🌟 My Eco Points</div>
          <div id="pointMeterBar" class="meter-bar"><span id="pointMeterFill" class="meter-fill"></span></div>
          <div class="points-score"><span id="myPoints">0</span> / <span id="nextBadgePoints">5</span></div>
        </div>
        <div class="my-badges-block">
          <div class="badges-label">🏅 My Badges</div>
          <div id="badgesArea" class="badges-area"></div>
          <div class="next-badge-msg" id="nextBadgeMsg"></div>
        </div>
      </div>
      <div class="group-achievement-block">
        <div class="group-label">👥 Tutorial Group Achievement</div>
        <div id="groupMeterBar" class="meter-bar"><span id="groupMeterFill" class="meter-fill group"></span></div>
        <div class="group-score">
          <span id="groupPoints">0</span> eco points for your group!
          <span id="groupGoal">(Goal: 50)</span>
        </div>
      </div>
    </div>
    <!-- END REWARDS/BADGES/POINTS METER SECTION -->
    <h2>Carbon Currency Form</h2>
    <form id="carbonForm" autocomplete="off" enctype="multipart/form-data">
      <label for="name">Name</label>
      <input type="text" id="name" name="name" required />

      <label for="email">Email</label>
      <input type="email" id="email" name="email" required />

      <label for="lecture-group">Lecture Group</label>
      <input type="text" id="lecture-group" name="lecture-group" required />

      <label for="tutorial-group">Tutorial Group</label>
      <input type="text" id="tutorial-group" name="tutorial-group" required />

      <label>Initiative Done</label>
      <div class="initiatives-list">
        <label class="initiative-label">
          <span class="initiative-icon">🥤</span>
          <input type="checkbox" name="initiative" value="Bringing own bottle/container to cafeteria">
          Bringing own bottle/container to cafeteria
        </label>
        <label class="initiative-label">
          <span class="initiative-icon">♻️</span>
          <input type="checkbox" name="initiative" value="Recycling plastic bottles/tin">
          Recycling plastic bottles/tin
        </label>
        <label class="initiative-label">
          <span class="initiative-icon">🚶‍♂️</span>
          <input type="checkbox" name="initiative" value="Walking to PASUM">
          Walking to PASUM
        </label>
        <label class="initiative-label">
          <span class="initiative-icon">🍴</span>
          <input type="checkbox" name="initiative" value="Use your own reusable utensils">
          Use your own reusable utensils
        </label>
        <label class="initiative-label">
          <span class="initiative-icon">🦵</span>
          <input type="checkbox" name="initiative" value="Use the stairs instead of the lift">
          Use the stairs instead of the lift
        </label>
        <label class="initiative-label other-initiative">
          <span class="initiative-icon">✨</span>
          <input type="checkbox" id="other-check" name="initiative" value="Other">
          Other:
          <input type="text" id="other-text" name="other-initiative" placeholder="Please specify" disabled />
        </label>
      </div>
      <label for="proof-photo" id="photo-proof-label">
        Upload Photo Proof (max 5MB, jpg/png):<br>
        <span style="font-size:0.92em;color:#888;">(You can use your camera 📸)</span>
      </label>
      <input type="file" id="proof-photo" name="proof-photo" accept="image/jpeg,image/png,image/*" capture="environment" required />
      <button type="submit">Submit 🚀</button>
      <div id="formStatus"></div>
    </form>
  </div>
  <div id="loadingOverlay">
    <div class="eco-hero-leaf">
      <svg width="84" height="84" viewBox="0 0 48 48" fill="none">
        <ellipse cx="24" cy="24" rx="22" ry="22" fill="#e1fbd4" />
        <path d="M13 35c10-17.5 22-22 22-22s-2 12-12 22c-4 4-8 0-10 0z" fill="#67c568" />
        <path d="M19 32c3-8 10-15 14-17" stroke="#2e6b3b" stroke-width="2.2" stroke-linecap="round"/>
      </svg>
    </div>
    <div class="eco-hero-message">
      🌱 Woohoo! You just earned an Eco Point!<br>Keep rocking, Eco Hero! 🎉
    </div>
  </div>
  <div class="confetti" id="confetti"></div>
  <script>
    // BADGES/POINTS SYSTEM (unchanged)
    const BADGES = [
      { emoji: "🌱", name: "Eco Rookie", points: 1, desc: "First eco step!" },
      { emoji: "🌿", name: "Green Sprout", points: 5, desc: "5 actions!" },
      { emoji: "🌳", name: "Eco Expert", points: 10, desc: "10 actions!" },
      { emoji: "🏆", name: "Eco Champion", points: 20, desc: "20+ actions!" }
    ];
    const GROUP_GOAL = 50;
    function getMyPoints() {
      return parseInt(localStorage.getItem('ecoPoints') || "0", 10);
    }
    function setMyPoints(val) {
      localStorage.setItem('ecoPoints', val);
    }
    function getGroupPoints(group) {
      return parseInt(localStorage.getItem(`ecoGroupPoints_${group}`) || "0", 10);
    }
    function setGroupPoints(group, val) {
      localStorage.setItem(`ecoGroupPoints_${group}`, val);
    }
    function getMyGroup() {
      return localStorage.getItem('ecoMyGroup') || "Your Group";
    }
    function setMyGroup(val) {
      localStorage.setItem('ecoMyGroup', val);
    }
    function updatePointsAndBadgesUI() {
      const points = getMyPoints();
      let nextBadge = BADGES.find(b => points < b.points) || BADGES[BADGES.length - 1];
      let prevBadge = BADGES.filter(b => points >= b.points);
      const badgesDiv = document.getElementById('badgesArea');
      badgesDiv.innerHTML = prevBadge.map(b => `<span title="${b.name}">${b.emoji}</span>`).join('');
      document.getElementById('nextBadgeMsg').textContent = (nextBadge && points < nextBadge.points)
        ? `Next: ${nextBadge.emoji} ${nextBadge.name} (${nextBadge.points - points} more!)`
        : `You're an ${BADGES[BADGES.length-1].name}!`;
      document.getElementById('myPoints').textContent = points;
      document.getElementById('nextBadgePoints').textContent = nextBadge.points;
      let barWidth = Math.min(100, points / nextBadge.points * 100);
      document.getElementById('pointMeterFill').style.width = barWidth + "%";
      const group = getMyGroup();
      let groupPoints = getGroupPoints(group);
      document.getElementById('groupPoints').textContent = groupPoints;
      document.getElementById('groupGoal').textContent = `(Goal: ${GROUP_GOAL})`;
      document.getElementById('groupMeterFill').style.width = Math.min(100, groupPoints / GROUP_GOAL * 100) + "%";
    }
    function setGroupFromForm(form) {
      const group = form['tutorial-group'].value.trim() || "Your Group";
      setMyGroup(group);
    }
    window.addEventListener('DOMContentLoaded', () => {
      updatePointsAndBadgesUI();
    });
    // Enable/disable the "Other" text input based on the checkbox
    const otherCheck = document.getElementById('other-check');
    const otherText = document.getElementById('other-text');
    otherCheck.addEventListener('change', function() {
      otherText.disabled = !this.checked;
      if (!this.checked) {
        otherText.value = '';
      } else {
        otherText.focus();
      }
    });
    // Google Apps Script Web App Endpoint
    const scriptBaseURL = "https://script.google.com/macros/s/AKfycbwuxal-q8-VF9-aGTcFPVSC8iCTfM2g07RpiGgtPBq6iFOxqEuDiorBFj9dL_ZOx2We1Q/exec";
    // Show/Hide overlay helper
    function showOverlay() {
      document.getElementById('loadingOverlay').classList.add('active');
    }
    function hideOverlay() {
      document.getElementById('loadingOverlay').classList.remove('active');
    }
    // Confetti burst effect
    function burstConfetti() {
      const confetti = document.getElementById('confetti');
      confetti.innerHTML = '';
      confetti.style.display = 'block';
      const colors = ['#48b97d', '#6fd7f7', '#ffd833', '#ffb3c6', '#7df6c3', '#e1fbd4'];
      const n = 40;
      for (let i = 0; i < n; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.background = colors[Math.floor(Math.random() * colors.length)];
        piece.style.left = (Math.random() * 100) + 'vw';
        piece.style.top = (Math.random() * 15 + 35) + 'vh';
        piece.style.transform = `rotate(${Math.random()*360}deg)`;
        piece.style.transition = 'all 1.3s cubic-bezier(.47,1.64,.41,.8)';
        confetti.appendChild(piece);
        setTimeout(() => {
          piece.style.top = (Math.random()*45 + 55) + 'vh';
          piece.style.left = (Math.random()*100) + 'vw';
          piece.style.opacity = 0;
          piece.style.transform = `rotate(${Math.random()*720}deg) scale(.7)`;
        }, 10);
      }
      setTimeout(() => { confetti.style.display = 'none'; }, 1700);
    }
    // Full form submission with Google Sheets/Drive integration (multipart with photo)
    document.getElementById('carbonForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const lectureGroup = document.getElementById('lecture-group').value.trim();
      const tutorialGroup = document.getElementById('tutorial-group').value.trim();
      const photoInput = document.getElementById('proof-photo');
      // Initiatives
      let initiativesArr = [];
      document.querySelectorAll('input[name="initiative"]:checked').forEach(cb => {
        if(cb.value === "Other") {
          const otherValue = otherText.value.trim();
          if(otherValue) {
            initiativesArr.push("Other: " + otherValue);
          } else {
            initiativesArr.push("Other");
          }
        } else {
          initiativesArr.push(cb.value);
        }
      });
      const initiatives = initiativesArr.join(", ");
      // File validation
      if (!photoInput.files.length) {
        document.getElementById('formStatus').innerText = "Please upload a photo proof.";
        return;
      }
      const photoFile = photoInput.files[0];
      if (photoFile.size > 5 * 1024 * 1024) {
        document.getElementById('formStatus').innerText = "Photo is too large (max 5MB).";
        return;
      }
      // Prepare multipart form data
      const formData = new FormData();
      formData.append("data", JSON.stringify({ name, email, lectureGroup, tutorialGroup, initiatives }));
      formData.append("photo", photoFile);
      showOverlay();
      try {
        await fetch(scriptBaseURL, {
          method: 'POST',
          body: formData
        });
        document.getElementById('carbonForm').reset();
        otherText.disabled = true;
        let points = getMyPoints() + 1;
        setMyPoints(points);
        setGroupFromForm(this);
        let group = getMyGroup();
        setGroupPoints(group, getGroupPoints(group) + 1);
        updatePointsAndBadgesUI();
        setTimeout(() => {
          hideOverlay();
          burstConfetti();
        }, 1800);
      } catch (err) {
        hideOverlay();
        document.getElementById('formStatus').style.color = "#d34b2d";
        document.getElementById('formStatus').textContent = "Submission failed. Please try again.";
      }
    });
  </script>
</body>
</html>